SET @saved_value= @@GLOBAL.slave_preserve_commit_order;
#
# Verify it can be queried corrected in different ways.
#
SELECT @@GLOBAL.slave_preserve_commit_order;
@@GLOBAL.slave_preserve_commit_order
DB
SELECT VARIABLE_VALUE FROM performance_schema.global_variables WHERE
VARIABLE_NAME = 'slave_preserve_commit_order';
VARIABLE_VALUE
DB
SHOW GLOBAL VARIABLES LIKE 'slave_preserve_commit_order';
Variable_name	Value
slave_preserve_commit_order	DB
#
# Verify it is not a session variable
#
SELECT @@SESSION.slave_preserve_commit_order;
ERROR HY000: Variable 'slave_preserve_commit_order' is a GLOBAL variable
SELECT VARIABLE_VALUE FROM performance_schema.session_variables WHERE
VARIABLE_NAME = 'slave_preserve_commit_order';
VARIABLE_VALUE
DB
SHOW SESSION VARIABLES LIKE 'slave_preserve_commit_order';
Variable_name	Value
slave_preserve_commit_order	DB
SET SESSION slave_preserve_commit_order= TRUE;
ERROR HY000: Variable 'slave_preserve_commit_order' is a GLOBAL variable and should be set with SET GLOBAL
SELECT @@global.slave_preserve_commit_order;
@@global.slave_preserve_commit_order
DB
#
# Verify it can be set correctly
#
SET GLOBAL slave_preserve_commit_order= true;
SELECT @@global.slave_preserve_commit_order;
@@global.slave_preserve_commit_order
DB
SELECT VARIABLE_VALUE FROM performance_schema.global_variables WHERE
VARIABLE_NAME = 'slave_preserve_commit_order';
VARIABLE_VALUE
DB
SET GLOBAL slave_preserve_commit_order= "NONE";
SELECT @@global.slave_preserve_commit_order;
@@global.slave_preserve_commit_order
NONE
SET GLOBAL slave_preserve_commit_order= "DB";
SELECT @@global.slave_preserve_commit_order;
@@global.slave_preserve_commit_order
DB
SET GLOBAL slave_preserve_commit_order= "GLOBAL";
SELECT @@global.slave_preserve_commit_order;
@@global.slave_preserve_commit_order
GLOBAL
SET GLOBAL slave_preserve_commit_order= DEFAULT;
SELECT @@global.slave_preserve_commit_order;
@@global.slave_preserve_commit_order
DB
#
# It should throw an error when encountering invalid value
#
SET GLOBAL slave_preserve_commit_order= NULL;
ERROR 42000: Variable 'slave_preserve_commit_order' can't be set to the value of 'NULL'
SELECT @@global.slave_preserve_commit_order;
@@global.slave_preserve_commit_order
DB
SET GLOBAL slave_preserve_commit_order= '';
ERROR 42000: Variable 'slave_preserve_commit_order' can't be set to the value of ''
SELECT @@global.slave_preserve_commit_order;
@@global.slave_preserve_commit_order
DB
SET GLOBAL slave_preserve_commit_order= 'GARBAGE';
ERROR 42000: Variable 'slave_preserve_commit_order' can't be set to the value of 'GARBAGE'
SELECT @@global.slave_preserve_commit_order;
@@global.slave_preserve_commit_order
DB
SET GLOBAL slave_preserve_commit_order = @saved_value;
